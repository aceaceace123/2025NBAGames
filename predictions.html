<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your NBA Playoffs Predictions</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap');

        .container {
            max-width: 100%;
            padding: 10px;
        }

        .bracket-container {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f5f5f5;
            margin: 10px;
            gap: 10px;
        }

        .conference {
            flex: 1;
            max-width: 45%;
        }

        .round {
            margin-bottom: 20px;
        }

        .round h3 {
            font-size: 0.9em;
            margin: 10px 0;
        }

        h2 {
            font-size: 1em;
            margin: 10px 0;
        }

        .matchup {
            border: 1px solid #ddd;
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 5px;
        }

        .team {
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 6px;
            margin: 2px 0;
            border-radius: 4px;
            text-align: left;
        }

        .team img {
            width: 36px;
            height: 36px;
            margin-right: 8px;
            margin-bottom: 0;
        }

        .team-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            font-size: 0.8em;
            gap: 4px;
        }

        .seed {
            color: #666;
            margin-bottom: 0;
        }

        .team-name {
            font-weight: 500;
        }

        .team.winner {
            background-color: #e8f5e9;
            font-weight: bold;
        }

        .finals {
            text-align: center;
            margin: 0 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .champion {
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            width: 90%;
            max-width: 140px;
            border: 2px solid;
            transition: all 0.3s ease;
            transform: scale(0.9);
        }

        .champion img {
            width: 45px;
            height: 45px;
            margin-bottom: 6px;
        }

        .champion h3 {
            margin: 4px 0;
            font-size: 0.85em;
            white-space: pre-line;
        }

        .incomplete-message {
            text-align: center;
            color: #666;
            margin: 10px;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
            font-size: 0.9em;
        }

        #champion-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.85em;
        }

        #champion-content img {
            margin-bottom: 6px;
        }

        #champion-content div {
            font-weight: bold;
            font-size: 0.95em;
        }

        #stats-button {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            background-color: #1d428a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            z-index: 100;
        }

        #stats-button:hover {
            background-color: #0c2340;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 15px auto;
        }

        .welcome-message {
            font-size: 0.8em !important;
            margin: 5px 0 !important;
        }

        h1 {
            font-family: 'Libre Baskerville', Baskerville, serif;
            font-size: 1.5em;
            margin: 15px 0;
            display: inline-block;
        }

        .typewriter {
            position: relative;
            overflow: hidden;
            border-right: 2px solid #000;
            white-space: nowrap;
            margin: 0;
            letter-spacing: 0.05em;
            animation: blink-caret 0.75s step-end infinite;
        }

        @keyframes blink-caret {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: #000
            }
        }

        @media (max-width: 768px) {
            .bracket-container {
                flex-direction: column;
                padding: 5px;
                margin: 5px;
            }

            .conference {
                max-width: 100%;
                margin-bottom: 15px;
            }

            .finals {
                order: 3;
                margin: 10px auto;
                width: 100%;
            }

            .champion {
                margin: 10px auto;
            }

            h1 {
                font-size: 1.2em !important;
                margin: 10px 0 !important;
            }

            .logo {
                font-size: 0.9em !important;
            }

            .team img {
                width: 32px;
                height: 32px;
                margin-right: 6px;
            }

            .team-info {
                font-size: 0.75em;
                gap: 3px;
            }

            #stats-button {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 0.8em;
            }
        }

        @media (max-width: 320px) {
            .team img {
                width: 28px;
                height: 28px;
                margin-right: 4px;
            }

            .team-info {
                font-size: 0.7em;
                gap: 2px;
            }
        }

        .prediction-history {
            margin-top: 40px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
        }

        .prediction-history h2 {
            color: white;
            margin-bottom: 15px;
            text-align: center;
        }

        .prediction-history-header {
            display: grid;
            grid-template-columns: 0.5fr 1fr 1fr 1.5fr;
            padding: 10px;
            background-color: #333;
            color: white;
            font-weight: bold;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .prediction-history-item {
            display: grid;
            grid-template-columns: 0.5fr 1fr 1fr 1.5fr;
            padding: 8px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 4px;
            margin-bottom: 5px;
            transition: background-color 0.3s;
        }

        .prediction-history-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .prediction-id,
        .prediction-matchup,
        .prediction-team,
        .prediction-time {
            display: flex;
            align-items: center;
        }

        .loading-message,
        .no-predictions,
        .error-message {
            color: white;
            text-align: center;
            padding: 15px;
        }

        .error-message {
            color: #ff6b6b;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">@NIKA</div>
            <h1>Your NBA Playoffs Predictions</h1>
            <div class="welcome-message">Welcome! Here's a summary of your predictions.</div>
        </header>

        <button id="stats-button">See others' predictions</button>

        <div id="stats-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>NBA Champion Predictions</h2>
                <p>Distribution of all users' championship predictions from database</p>
                <div class="chart-container">
                    <canvas id="predictions-chart"></canvas>
                </div>
            </div>
        </div>

        <main>
            <div id="incomplete-message" class="incomplete-message" style="display: none;">
                <p>You haven't completed all your predictions yet. Please complete all matchups to see your full
                    bracket.</p>
                <p>Click <a href="matchup1W.html">here</a> to continue making predictions.</p>
            </div>
            <div id="bracket-container" class="bracket-container" style="display: none;">
                <div class="conference">
                    <h2>Western Conference</h2>
                    <div class="round" id="west-round1">
                        <h3>First Round</h3>
                    </div>
                    <div class="round" id="west-round2">
                        <h3>Conference Semifinals</h3>
                    </div>
                    <div class="round" id="west-round3">
                        <h3>Conference Finals</h3>
                    </div>
                </div>

                <div class="finals">
                    <h2>NBA Finals</h2>
                    <div id="finals-matchup"></div>
                    <div id="champion-display" class="champion">
                        <h3>2025
                            NBA Champion</h3>
                        <div id="champion-content"></div>
                    </div>
                </div>

                <div class="conference">
                    <h2>Eastern Conference</h2>
                    <div class="round" id="east-round1">
                        <h3>First Round</h3>
                    </div>
                    <div class="round" id="east-round2">
                        <h3>Conference Semifinals</h3>
                    </div>
                    <div class="round" id="east-round3">
                        <h3>Conference Finals</h3>
                    </div>
                </div>
            </div>

            <div id="predictions-summary" class="predictions-summary">
                <!-- User predictions will be displayed here -->
            </div>

            <div id="prediction-history" class="prediction-history">
                <h2>Your Prediction History</h2>
                <div class="prediction-history-header">
                    <span class="prediction-id">ID</span>
                    <span class="prediction-matchup">Matchup</span>
                    <span class="prediction-team">Team</span>
                    <span class="prediction-time">Timestamp</span>
                </div>
                <div id="prediction-history-list">
                    <p class="loading-message">Loading your prediction history...</p>
                </div>
            </div>

            <div class="stats-section">
                <button id="statsBtn" class="stats-button">See Others' Predictions</button>
                <div id="statsModal" class="modal">
                    <div class="modal-content">
                        <span class="close-button">&times;</span>
                        <h2>NBA Champion Predictions</h2>
                        <canvas id="pieChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="script.js"></script>
    <script>
        // Define team details if not already imported from script.js
        const teamDetails = {
            "OKC": {
                name: "Oklahoma City Thunder",
                logo: "images/logos/OKC.png",
                seed: 1,
                conference: "Western"
            },
            "MIN": {
                name: "Minnesota Timberwolves",
                logo: "images/logos/MIN.png",
                seed: 8,
                conference: "Western"
            },
            "DEN": {
                name: "Denver Nuggets",
                logo: "images/logos/DEN.png",
                seed: 4,
                conference: "Western"
            },
            "LAC": {
                name: "LA Clippers",
                logo: "images/logos/LAC.png",
                seed: 5,
                conference: "Western"
            },
            "LAL": {
                name: "Los Angeles Lakers",
                logo: "images/logos/LAL.png",
                seed: 3,
                conference: "Western"
            },
            "GSW": {
                name: "Golden State Warriors",
                logo: "images/logos/GSW.png",
                seed: 6,
                conference: "Western"
            },
            "HOU": {
                name: "Houston Rockets",
                logo: "images/logos/HOU.png",
                seed: 2,
                conference: "Western"
            },
            "MEM": {
                name: "Memphis Grizzlies",
                logo: "images/logos/MEM.png",
                seed: 7,
                conference: "Western"
            },
            "CLE": {
                name: "Cleveland Cavaliers",
                logo: "images/logos/CLE.png",
                seed: 1,
                conference: "Eastern"
            },
            "ATL": {
                name: "Atlanta Hawks",
                logo: "images/logos/ATL.png",
                seed: 8,
                conference: "Eastern"
            },
            "IND": {
                name: "Indiana Pacers",
                logo: "images/logos/IND.png",
                seed: 4,
                conference: "Eastern"
            },
            "MIL": {
                name: "Milwaukee Bucks",
                logo: "images/logos/MIL.png",
                seed: 5,
                conference: "Eastern"
            },
            "NYK": {
                name: "New York Knicks",
                logo: "images/logos/NYK.png",
                seed: 3,
                conference: "Eastern"
            },
            "DET": {
                name: "Detroit Pistons",
                logo: "images/logos/DET.png",
                seed: 6,
                conference: "Eastern"
            },
            "BOS": {
                name: "Boston Celtics",
                logo: "images/logos/BOS.png",
                seed: 2,
                conference: "Eastern"
            },
            "ORL": {
                name: "Orlando Magic",
                logo: "images/logos/ORL.png",
                seed: 7,
                conference: "Eastern"
            }
        };

        function typewriterEffect(element, text, speed = 80) {
            element.textContent = '';

            let i = 0;
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }

            type();
        }

        function initializePredictions() {
            const predictionsSummaryDiv = document.getElementById('predictions-summary');
            const bracketDisplayDiv = document.getElementById('bracket-display');

            if (predictionsSummaryDiv && bracketDisplayDiv) {
                const storedR1 = JSON.parse(localStorage.getItem('round1Predictions') || '{}');
                const storedR2 = JSON.parse(localStorage.getItem('round2Predictions') || '{}');
                const storedR3 = JSON.parse(localStorage.getItem('round3Predictions') || '{}');
                const storedR4 = JSON.parse(localStorage.getItem('round4Predictions') || '{}');

                console.log('Round 1 Predictions:', storedR1);
                console.log('Round 2 Predictions:', storedR2);
                console.log('Round 3 Predictions:', storedR3);
                console.log('Round 4 Predictions:', storedR4);

                const r1Complete = Object.keys(storedR1).length === 8;
                const r2Complete = Object.keys(storedR2).length === 4;
                const r3Complete = Object.keys(storedR3).length === 2;
                const r4Complete = Object.keys(storedR4).length === 1;
                const allComplete = r1Complete && r2Complete && r3Complete && r4Complete;

                if (allComplete) {
                    // Display complete bracket
                    const pageTitle = document.querySelector('.container header h1');
                    if (pageTitle) pageTitle.textContent = 'Your Final Predictions';

                    predictionsSummaryDiv.classList.add('hidden');
                    bracketDisplayDiv.style.display = 'flex';

                    const getTeam = (roundStore, matchupId) => {
                        const winnerAbbr = roundStore[matchupId];
                        if (winnerAbbr && teamDetails[winnerAbbr]) {
                            return { abbr: winnerAbbr, ...teamDetails[winnerAbbr] };
                        }
                        return { abbr: 'TBD', name: 'TBD', logo: 'placeholder.png', seed: '?' };
                    };

                    const r1Winners = {
                        W1v8: getTeam(storedR1, "W1v8"), W4v5: getTeam(storedR1, "W4v5"),
                        W3v6: getTeam(storedR1, "W3v6"), W2v7: getTeam(storedR1, "W2v7"),
                        E1v8: getTeam(storedR1, "E1v8"), E4v5: getTeam(storedR1, "E4v5"),
                        E3v6: getTeam(storedR1, "E3v6"), E2v7: getTeam(storedR1, "E2v7")
                    };
                    const r2Winners = {
                        R2W1: getTeam(storedR2, "R2W1"), R2W2: getTeam(storedR2, "R2W2"),
                        R2E1: getTeam(storedR2, "R2E1"), R2E2: getTeam(storedR2, "R2E2")
                    };
                    const r3Winners = { R3W: getTeam(storedR3, "R3W"), R3E: getTeam(storedR3, "R3E") };
                    const champion = getTeam(storedR4, "R4F");

                    const createTeamHTML = (teamData, isWinner = false) => `
                        <div class="bracket-team ${isWinner ? 'winner' : ''}">
                            <img src="${teamData.logo}" alt="${teamData.name}">
                            <span>(${teamData.seed}) ${teamData.abbr}</span>
                        </div>`;

                    const createMatchupHTML = (team1, team2, winnerAbbr) => `
                        <div class="bracket-matchup">
                            ${createTeamHTML(team1, team1.abbr === winnerAbbr)}
                            ${createTeamHTML(team2, team2.abbr === winnerAbbr)}
                        </div>`;

                    bracketDisplayDiv.innerHTML = `
                        <h2>Your Predicted Bracket</h2>
                        <div class="bracket-region"> <!-- West -->
                            <div class="bracket-round"> <!-- R1 West -->
                                ${createMatchupHTML(teamDetails['OKC'], teamDetails['MIN'], r1Winners['W1v8'].abbr)}
                                ${createMatchupHTML(teamDetails['DEN'], teamDetails['LAC'], r1Winners['W4v5'].abbr)}
                                ${createMatchupHTML(teamDetails['LAL'], teamDetails['GSW'], r1Winners['W3v6'].abbr)}
                                ${createMatchupHTML(teamDetails['HOU'], teamDetails['MEM'], r1Winners['W2v7'].abbr)}
                            </div>
                            <div class="bracket-round"> <!-- R2 West -->
                                 ${createMatchupHTML(r1Winners['W1v8'], r1Winners['W4v5'], r2Winners['R2W1'].abbr)}
                                 ${createMatchupHTML(r1Winners['W3v6'], r1Winners['W2v7'], r2Winners['R2W2'].abbr)}
                            </div>
                            <div class="bracket-round"> <!-- R3 West -->
                                 ${createMatchupHTML(r2Winners['R2W1'], r2Winners['R2W2'], r3Winners['R3W'].abbr)}
                            </div>
                        </div>
                        <div class="bracket-final-region"> <!-- Finals -->
                             <div class="bracket-champion" data-team-abbr="${champion.abbr}">
                                  <img src="${champion.logo}" alt="${champion.name}">
                                  <span>${champion.abbr}</span>
                                  <div class="title">2025 NBA Champion</div>
                             </div>
                        </div>
                        <div class="bracket-region"> <!-- East -->
                             <div class="bracket-round"> <!-- R3 East -->
                                  ${createMatchupHTML(r2Winners['R2E1'], r2Winners['R2E2'], r3Winners['R3E'].abbr)}
                             </div>
                             <div class="bracket-round"> <!-- R2 East -->
                                  ${createMatchupHTML(r1Winners['E1v8'], r1Winners['E4v5'], r2Winners['R2E1'].abbr)}
                                  ${createMatchupHTML(r1Winners['E3v6'], r1Winners['E2v7'], r2Winners['R2E2'].abbr)}
                             </div>
                             <div class="bracket-round"> <!-- R1 East -->
                                ${createMatchupHTML(teamDetails['CLE'], teamDetails['ATL'], r1Winners['E1v8'].abbr)}
                                ${createMatchupHTML(teamDetails['IND'], teamDetails['MIL'], r1Winners['E4v5'].abbr)}
                                ${createMatchupHTML(teamDetails['NYK'], teamDetails['DET'], r1Winners['E3v6'].abbr)}
                                ${createMatchupHTML(teamDetails['BOS'], teamDetails['ORL'], r1Winners['E2v7'].abbr)}
                            </div>
                        </div>
                    `;
                } else {
                    // Show text summary of current predictions
                    bracketDisplayDiv.style.display = 'none';
                    predictionsSummaryDiv.classList.remove('hidden');

                    let predictionsHTML = '<h2>Round 1 Picks:</h2>';
                    if (r1Complete) {
                        // Display Round 1 predictions
                        const round1Matchups = [
                            { id: 'W1v8', conference: 'Western', matchupNum: 1 },
                            { id: 'W4v5', conference: 'Western', matchupNum: 2 },
                            { id: 'W3v6', conference: 'Western', matchupNum: 3 },
                            { id: 'W2v7', conference: 'Western', matchupNum: 4 },
                            { id: 'E1v8', conference: 'Eastern', matchupNum: 1 },
                            { id: 'E4v5', conference: 'Eastern', matchupNum: 2 },
                            { id: 'E3v6', conference: 'Eastern', matchupNum: 3 },
                            { id: 'E2v7', conference: 'Eastern', matchupNum: 4 }
                        ];

                        round1Matchups.forEach(r1m => {
                            const winnerAbbr = storedR1[r1m.id];
                            const winnerName = winnerAbbr && teamDetails[winnerAbbr] ? teamDetails[winnerAbbr].name : '(Not selected)';
                            predictionsHTML += `<p>${r1m.conference} Matchup ${r1m.matchupNum}: ${winnerName} wins</p>`;
                        });
                    } else {
                        predictionsHTML += '<p>Round 1 predictions incomplete.</p>';
                    }

                    predictionsHTML += '<h2 style="margin-top: 30px;">Round 2 Picks:</h2>';
                    if (r2Complete) {
                        // Display Round 2 predictions
                        const roundSources = {
                            "R2W1": { name: "Western Conference Semifinal 1" },
                            "R2W2": { name: "Western Conference Semifinal 2" },
                            "R2E1": { name: "Eastern Conference Semifinal 1" },
                            "R2E2": { name: "Eastern Conference Semifinal 2" }
                        };

                        ["R2W1", "R2W2", "R2E1", "R2E2"].forEach(r2Id => {
                            const winnerAbbr = storedR2[r2Id];
                            const winnerName = winnerAbbr && teamDetails[winnerAbbr] ? teamDetails[winnerAbbr].name : '(Not selected)';
                            predictionsHTML += `<p>${roundSources[r2Id].name}: ${winnerName} wins</p>`;
                        });
                    } else {
                        predictionsHTML += `<p>Round 2 predictions ${r1Complete ? 'incomplete or not started' : 'cannot start until Round 1 is complete'}.</p>`;
                    }

                    predictionsHTML += '<h2 style="margin-top: 30px;">Round 3 Picks (Conference Finals):</h2>';
                    if (r3Complete) {
                        // Display Round 3 predictions
                        const roundSources = {
                            "R3W": { name: "Western Conference Final" },
                            "R3E": { name: "Eastern Conference Final" }
                        };

                        ["R3W", "R3E"].forEach(r3Id => {
                            const winnerAbbr = storedR3[r3Id];
                            const winnerName = winnerAbbr && teamDetails[winnerAbbr] ? teamDetails[winnerAbbr].name : '(Not selected)';
                            predictionsHTML += `<p>${roundSources[r3Id].name}: ${winnerName} wins</p>`;
                        });
                    } else {
                        predictionsHTML += `<p>Round 3 predictions ${r2Complete ? 'incomplete or not started' : 'cannot start until Round 2 is complete'}.</p>`;
                    }

                    predictionsHTML += '<h2 style="margin-top: 30px;">Round 4 Pick (NBA Finals):</h2>';
                    if (r4Complete) {
                        // Display NBA Finals prediction
                        const winnerAbbr = storedR4["R4F"];
                        const winnerName = winnerAbbr && teamDetails[winnerAbbr] ? teamDetails[winnerAbbr].name : '(Not selected)';
                        predictionsHTML += `<p>NBA Champion: ${winnerName}</p>`;
                    } else {
                        predictionsHTML += `<p>NBA Finals prediction ${r3Complete ? 'incomplete or not started' : 'cannot start until Conference Finals are complete'}.</p>`;
                    }

                    predictionsSummaryDiv.innerHTML = predictionsHTML;
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // 檢查URL參數是否包含champion
            const urlParams = new URLSearchParams(window.location.search);
            const championFromURL = urlParams.get('champion');

            // 如果URL中有champion參數，確保它被保存到localStorage
            if (championFromURL) {
                console.log('從URL獲取冠軍:', championFromURL);
                const storageKey = 'round4Predictions';
                let storedPredictions = {};
                storedPredictions['R4F'] = championFromURL;
                localStorage.setItem(storageKey, JSON.stringify(storedPredictions));
                console.log('從URL參數保存冠軍到localStorage');
            }

            initializePredictions();
        });

        document.addEventListener('DOMContentLoaded', function () {
            const username = localStorage.getItem('nbaPlayoffsUsername');

            // Display welcome message
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg && username) {
                welcomeMsg.textContent = `Welcome, ${username}! Here's a summary of your predictions.`;
            }

            // Load prediction history from database
            loadPredictionHistory();

            // Stats button click event
            const statsBtn = document.getElementById('statsBtn');
            const statsModal = document.getElementById('statsModal');
            const closeBtn = document.querySelector('.close-button');

            if (statsBtn && statsModal) {
                statsBtn.onclick = function () {
                    statsModal.style.display = "block";
                    loadChampionshipStats();
                }
            }

            if (closeBtn) {
                closeBtn.onclick = function () {
                    statsModal.style.display = "none";
                }
            }

            window.onclick = function (event) {
                if (event.target == statsModal) {
                    statsModal.style.display = "none";
                }
            }
        });

        function loadPredictionHistory() {
            const historyContainer = document.getElementById('prediction-history-list');
            const currentUser = localStorage.getItem('nbaPlayoffsUsername');

            if (!currentUser || !historyContainer) {
                return;
            }

            fetch(`https://two025nbagames-1.onrender.com/predictions/${currentUser}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.length > 0) {
                        historyContainer.innerHTML = '';

                        // Sort predictions by timestamp (newest first)
                        data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                        data.forEach(prediction => {
                            // Format the timestamp
                            const predDate = new Date(prediction.timestamp);
                            const formattedDate = `${predDate.getFullYear()}-${String(predDate.getMonth() + 1).padStart(2, '0')}-${String(predDate.getDate()).padStart(2, '0')} ${String(predDate.getHours()).padStart(2, '0')}:${String(predDate.getMinutes()).padStart(2, '0')}`;

                            const predictionItem = document.createElement('div');
                            predictionItem.className = 'prediction-history-item';
                            predictionItem.innerHTML = `
                                <span class="prediction-id">${prediction.id}</span>
                                <span class="prediction-matchup">${prediction.matchup_id}</span>
                                <span class="prediction-team">${prediction.selected_team}</span>
                                <span class="prediction-time">${formattedDate}</span>
                            `;
                            historyContainer.appendChild(predictionItem);
                        });
                    } else {
                        historyContainer.innerHTML = '<p class="no-predictions">No prediction history found. Make some predictions!</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching prediction history:', error);
                    historyContainer.innerHTML = '<p class="error-message">Failed to load prediction history. Please try again later.</p>';
                });
        }
    </script>
</body>

</html>